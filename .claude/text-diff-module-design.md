# 文本差异对比模块设计文档

## 📋 功能需求分析

### 核心功能
1. **双栏文本输入**
   - 左侧：原始文本
   - 右侧：对比文本
   - 支持大段文本

2. **差异高亮显示**
   - 绿色高亮：新增内容
   - 红色高亮：删除内容
   - 黄色高亮：修改内容

3. **显示模式**
   - 并排对比模式（side-by-side）
   - 行内对比模式（inline）

4. **对比粒度**
   - 行级对比（按行分割）
   - 词级对比（按词分割）

5. **操作功能**
   - 实时对比（输入时自动对比）
   - 手动触发对比按钮
   - 清空文本
   - 复制结果
   - 导出报告

---

## 🛠️ 技术方案

### 依赖库选择
**方案1：jsdiff** (推荐)
- 轻量级（约30KB）
- 支持行级、词级、字符级对比
- API简单易用
- 无需额外依赖

**方案2：diff2html**
- 功能强大，支持HTML渲染
- 但体积较大
- 依赖jsdiff

**最终选择：jsdiff**
- 原因：轻量、功能满足需求、集成简单

### 技术栈
- **前端框架**：Vue 3 + TypeScript
- **Diff算法**：jsdiff
- **语法高亮**：highlight.js（可选）
- **样式**：Tailwind CSS（与项目一致）

---

## 📐 UI设计

### 布局结构
```
┌─────────────────────────────────────────────────┐
│  标题区：文本差异对比                            │
│  [对比模式切换] [对比粒度] [开始对比] [清空]      │
├──────────────────┬─────────────────────────────┤
│                  │                             │
│  原始文本         │  对比文本                   │
│  [文本框]        │  [文本框]                   │
│                  │                             │
├──────────────────┴─────────────────────────────┤
│                                                     │
│  对比结果区域                                        │
│  [高亮显示差异]                                       │
│                                                     │
├─────────────────────────────────────────────────┤
│  统计信息：新增X行/词，删除Y行/词，修改Z行/词       │
│  [复制结果] [导出报告]                               │
└─────────────────────────────────────────────────┘
```

### 组件设计
- **主组件**：TextDiff.vue
- **输入区域**：左右两个textarea
- **控制面板**：模式切换、粒度选择、操作按钮
- **结果展示区**：高亮显示差异
- **统计面板**：差异统计信息

---

## 📦 模块结构

```
src/modules/text-diff/
├── TextDiff.vue         # 主组件
├── index.ts            # 导出文件
├── types.ts            # 类型定义
└── services/
    └── diff.service.ts # 差异对比逻辑
```

---

## ⚙️ 功能特性

### 对比模式
1. **并排模式**
   - 左侧显示原文
   - 右侧显示对比文本
   - 用线条连接相同行

2. **行内模式**
   - 在同一行内显示差异
   - 红色删除线：删除内容
   - 绿色背景：新增内容

### 对比粒度
1. **行级对比**
   - 按行分割文本
   - 高亮整行差异

2. **词级对比**
   - 按空格/标点分割
   - 高亮词级别的差异

### 交互功能
- **实时对比**：输入时延迟500ms自动对比
- **手动触发**：点击"开始对比"按钮
- **结果操作**：
  - 复制到剪贴板
  - 下载HTML报告
  - 清空所有文本

---

## 🎨 视觉设计

### 颜色方案
- **新增内容**：绿色背景 `bg-green-100 dark:bg-green-900/20`
- **删除内容**：红色背景 `bg-red-100 dark:bg-red-900/20`
- **修改内容**：黄色背景 `bg-yellow-100 dark:bg-yellow-900/20`
- **文字颜色**：深绿色文字 `text-green-800 dark:text-green-300`

### 样式规范
- 使用Tailwind CSS类
- 保持与项目其他模块一致的视觉风格
- 支持暗色主题
- 响应式设计

---

## 🧪 测试策略

### 测试用例
1. **基本功能测试**
   - 空文本对比
   - 相同文本对比
   - 完全不同的文本对比

2. **差异检测测试**
   - 单行差异
   - 多行差异
   - 词级差异

3. **UI交互测试**
   - 模式切换
   - 粒度切换
   - 按钮响应

4. **性能测试**
   - 大文本对比（>1000行）
   - 并排模式性能
   - 词级对比性能

---

## 📊 实现计划

### 阶段1：基础框架
- 创建模块目录和文件
- 实现基础UI布局
- 集成jsdiff库

### 阶段2：核心功能
- 实现文本输入
- 实现diff算法调用
- 实现结果高亮显示

### 阶段3：交互优化
- 实现模式切换
- 实现粒度切换
- 添加操作按钮

### 阶段4：完善功能
- 实现复制/导出
- 添加统计信息
- 性能优化

### 阶段5：测试验证
- 编写单元测试
- 进行E2E测试
- 性能测试

---

## 🔄 开发流程

### 步骤
1. 创建模块目录结构
2. 实现基础组件
3. 集成diff服务
4. 实现UI功能
5. 添加测试用例
6. 构建验证
7. 提交代码

### 预计时间
- 总计：约2-3小时
- 基础框架：30分钟
- 核心功能：60分钟
- UI优化：60分钟
- 测试验证：30分钟

---

## 📝 开发要点

### 注意事项
1. **性能优化**
   - 大文本时使用防抖
   - 虚拟滚动（如果需要）
   - 避免不必要的重渲染

2. **用户体验**
   - 加载状态提示
   - 空状态处理
   - 错误提示

3. **代码质量**
   - 完整的TypeScript类型定义
   - 中文注释
   - 遵循项目代码规范

### 复用组件
- 参考其他模块的结构
- 复用项目通用样式
- 使用现有的事件总线

---

**设计完成，准备开始实现！** 🚀
